services:
  # Serviciul 1: Aplicația Next.js (Node 20)
  nextjs_app:
    container_name: platforma-ticketing
    build: .             # Se va uita în Dockerfile (asigură-te că e Node 20 acolo)
    restart: always
    environment:
      - NODE_ENV=production

  # Serviciul 2: Nginx (Reverse Proxy Local)
  nginx:
    image: nginx:alpine
    container_name: web-server
    restart: always
    ports:
      - "80:80"          # Site-ul e accesibil și pe http://localhost
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - nextjs_app

  # Serviciul 3: Ngrok (Tunelul către Internet)
  ngrok:
    image: ngrok/ngrok:latest
    container_name: ngrok-tunnel
    restart: unless-stopped
    command:
      # Îi spunem să facă tunel către serviciul "nginx" pe portul 80
      - "http"
      - "nginx:80"
    environment:
      # LIPESTE TOKENUL TĂU MAI JOS
      NGROK_AUTHTOKEN: "376Z80ROyDxcxtgp9I9IszWJvwa_qeE3jQJ6nEptxYE4vi6r"
    ports:
      - "4040:4040"      # Interfața de status ngrok
    depends_on:
      - nginx